Je veux ajouter un systÃ¨me complet de notifications de nouveaux messages, avec des pastilles rouges visibles partout dans lâ€™application. Merci de lire tout le projet et de modifier proprement le frontend + backend. Voici exactement ce que je veux :

ğŸ”´ 1. Pastille rouge globale (icÃ´ne â€œMessagesâ€)

Mettre un indicateur rouge (badge) sur lâ€™icÃ´ne â€œMessagesâ€ partout oÃ¹ elle apparaÃ®t dans lâ€™application.
Cette pastille doit apparaÃ®tre si :

au moins une conversation contient un message non lu par lâ€™utilisateur connectÃ©.

Le badge doit Ãªtre synchronisÃ© :

sur la page dâ€™accueil

dans la navbar

dans le dashboard prof/admin/Ã©lÃ¨ve

dans tout endroit contenant lâ€™icÃ´ne â€œMessagesâ€

DÃ¨s que tout est lu, la pastille rouge doit disparaÃ®tre partout instantanÃ©ment.

ğŸ“© 2. Pastille rouge sur chaque conversation

Dans la liste des conversations :

afficher une pastille rouge sur chaque conversation qui contient au moins un message non lu par lâ€™utilisateur connectÃ©.

Les rÃ¨gles :

si lâ€™utilisateur ouvre la conversation, tous les messages non lus de cette conversation deviennent lus

la pastille disparaÃ®t immÃ©diatement

lâ€™icÃ´ne globale "Messages" doit se mettre Ã  jour automatiquement

ğŸ“¥ 3. Marquage des messages comme lus
Ajouter dans la base de donnÃ©es (Drizzle) :

Une table message_reads ou un champ similaire permettant de savoir si un utilisateur a lu un message.

Structure suggÃ©rÃ©e :
message_reads

id

messageId

userId

readAt (timestamp)

Ã€ chaque message reÃ§u par un utilisateur :

il est â€œnon luâ€ tant quâ€™il nâ€™est pas dans message_reads

Ã€ lâ€™ouverture dâ€™une conversation :

tous les messages de lâ€™autre participant sont marquÃ©s comme lus

suppression immÃ©diate des pastilles

ğŸŒ 4. API Ã  ajouter
GET /notifications/unread-count

Retourne :

le nombre total de conversations non lues

le nombre total de messages non lus

GET /notifications/conversations

Retourne la liste des conversations avec :

conversationId

hasUnread: true/false

POST /notifications/mark-conversation-read

Body : { conversationId }
Marque tous les messages de cette conversation comme lus pour lâ€™utilisateur courant.

âš¡ 5. Mise Ã  jour temps rÃ©el (Socket.IO)

Quand un message est envoyÃ© :

le destinataire reÃ§oit un Ã©vÃ©nement message:new

mettre Ã  jour automatiquement :

la pastille globale

la pastille sur la conversation

la liste de conversations

Quand une conversation est ouverte :

envoyer un Ã©vÃ©nement conversation:read

le backend met Ã  jour les message_reads

renvoie immÃ©diatement la nouvelle valeur des pastilles

ğŸ¨ 6. IntÃ©gration front-end (React/Tailwind ou stack du projet)

Ajouter un composant global <MessageNotificationsProvider> qui Ã©coute les sockets

Stocker les conversations non lues dans un contexte global

RafraÃ®chir les badges sur :

la navbar

les pages dashboard

la liste de conversations

Pastille minimaliste : petit cercle rouge (Tailwind: bg-red-500 w-2 h-2 rounded-full)

ğŸ” 7. Permissions (Ã  conserver)

Garder toutes les rÃ¨gles prÃ©cÃ©demment implÃ©mentÃ©es :

students peuvent contacter teachers + admins

teachers peuvent contacter admins

admins peuvent contacter students + teachers

teachers ne peuvent pas lancer une conversation avec students

etc.

Aucune modification de permissions.
Juste les notifications.

ğŸ§© 8. Ã€ fournir

Je veux que tu :

lises le code existant

ajoutes proprement les nouvelles tables Drizzle

modifies les routes nÃ©cessaires

mettes Ã  jour les sockets

ajoutes les badges dans le frontend

fournisses les diffs complets puis modifies les fichiers

gardes toute la structure propre et cohÃ©rente

Merci de rÃ©aliser tout cela proprement, Ã©tape par Ã©tape.